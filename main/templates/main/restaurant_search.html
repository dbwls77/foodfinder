<!DOCTYPE html>
<html>
<head>
    <title>Restaurant Search</title>
</head>
<body>
    <h1>Search for Restaurants</h1>

    <form id="search-form" method="get" action="">
        {{ form.as_p }}
        <input type="submit" value="Search">
    </form>

    <h2>Search Results</h2>
    {% if restaurant_data %}
        {% for data in restaurant_data %}
            <div>
                <h3>{{ data.restaurant.name }}</h3>
                <!-- <p>Cuisine: {{ data.restaurant.cuisine_type }}</p> -->
                {% if data.distance %}
                    <p>Distance: {{ data.distance|floatformat:2 }} miles</p>
                {% else %}
                    <p>{data.distance}</p>
                {% endif %}
                <p>
                    <a href="https://www.google.com/maps/search/?api=1&query={{ data.restaurant.latitude }},{{ data.restaurant.longitude }}" target="_blank">
                        View on Google Maps
                    </a>
                </p>
            </div>
        {% endfor %}
    {% else %}
        <p>No restaurants found.</p>
    {% endif %}

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('search-form');

        // Intercept the form submission
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form submission

            // Check if geolocation is supported
            if (navigator.geolocation) {
                // Get the user's location
                navigator.geolocation.getCurrentPosition(function(position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    // Create hidden input fields for latitude and longitude
                    var latInput = document.createElement('input');
                    latInput.type = 'hidden';
                    latInput.name = 'latitude';
                    latInput.value = latitude;
                    form.appendChild(latInput);

                    var lonInput = document.createElement('input');
                    lonInput.type = 'hidden';
                    lonInput.name = 'longitude';
                    lonInput.value = longitude;
                    form.appendChild(lonInput);

                    // Now that latitude and longitude are added, submit the form
                    form.submit();
                }, function(error) {
                    console.error('Error getting location:', error);
                    alert('Could not get your location. Please try again.');
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });
    });
    </script>
</body>
</html>
